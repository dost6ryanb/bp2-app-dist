(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-83c7201e"],{3220:function(e,t,a){},"742f":function(e,t,a){"use strict";a("3220")},"89be":function(e,t,a){"use strict";a.r(t);var i,n,r,s,l,o,d=a("b0af"),c=a("99d9"),h=a("a523"),u=a("2e4b"),_=a("0e8f"),v=a("a722"),p=a("e449"),m=a("490a"),f=a("2677"),w=(a("d81d"),a("4de4"),a("d3b7"),function(){var e=this,t=e._self._c;return t(d["a"],[t(v["a"],{attrs:{row:"",wrap:""}},["loaded"===e.loading||"nodata"===e.loading?t(_["a"],{attrs:{xs12:"","d-flex":""}},[t("device-info",{attrs:{dev_id:e.device.dev_id,province:e.device.province,citymun:e.device.citymun,location:e.device.location,status:e.device.status},on:{updatedStatus:e.onUpdatedDeviceStatus}})],1):e._e(),"loading"===e.loading?t(_["a"],{attrs:{xs12:"","d-flex":""}},[t(v["a"],{attrs:{"justify-center":"","align-center":"","pa-4":""}},[t(m["a"],{attrs:{indeterminate:"",color:"primary"}})],1)],1):e._e(),"loaded"===e.loading?t(_["a"],{attrs:{xs12:"","d-flex":""}},[t(c["b"],{staticClass:"pt-0"},[t(v["a"],{staticStyle:{"max-height":"calc(90vh - 200px)"},attrs:{column:""}},[t(_["a"],{staticStyle:{overflow:"auto"},attrs:{xs12:""}},["last_data"===e.selectedView?t("device-data-peek",{attrs:{data:e.latest_response}}):"table"===e.selectedView?t("device-data-table",{attrs:{data:e.response,columns:e.columns}}):"rainfall"===e.selectedView?t("device-data-rainfall-chart",{attrs:{data:e.rainfall_response,title:e.title}}):"waterlevel"===e.selectedView?t("device-data-waterlevel-chart",{attrs:{data:e.waterlevel_response,title:e.title,threshold:e.device_waterlevel_threshold_response}}):"heat_index"===e.selectedView?t("device-data-heat-index-chart",{attrs:{data:e.heatindex_response,title:e.title}}):"thresholds"===e.selectedView?t("device-threshold",{attrs:{data:e.device_waterlevel_threshold_response},on:{threshold_updated:e.onUpdatedThresholds}}):e._e()],1)],1)],1)],1):e._e(),"nodata"===e.loading?t(_["a"],{attrs:{xs12:"","d-flex":""}},[t(h["a"],{staticClass:"px-3 pb-3 pt-0 ma-0"},[t("h3",[e._v("No Data")])])],1):e._e(),"loaded"===e.loading||"nodata"===e.loading?t(_["a"],{attrs:{xs12:"","d-flex":""}},[t(c["a"],{staticClass:"grey lighten-3"},[t(v["a"],{attrs:{row:"",wrap:"","align-center":""}},[t(_["a"],{attrs:{xs8:""}},[t(p["a"],{attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(a){var i=a.on;return[t(f["a"],e._g({staticClass:"pa-0",staticStyle:{"min-width":"200px","max-width":"200px"},attrs:{value:e.computedDateFormattedMomentjs(e.selectedDate),"prepend-icon":"event",readonly:"",clearable:""},on:{"click:clear":e.onDateClear}},i))]}}],null,!1,4022347716),model:{value:e.menuDate,callback:function(t){e.menuDate=t},expression:"menuDate"}},[t(u["a"],{attrs:{max:e.maxDateWMO,"no-title":"",scrollable:""},on:{input:e.onDateInput},model:{value:e.selectedDate,callback:function(t){e.selectedDate=t},expression:"selectedDate"}})],1)],1),"loaded"===e.loading?t(_["a"],{staticClass:"text-xs-right",attrs:{xs4:""}},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedView,expression:"selectedView"}],staticClass:"primary white--text pa-1 text-xs-center",staticStyle:{"border-style":"solid"},attrs:{id:"selectedView"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedView=t.target.multiple?a:a[0]}}},e._l(e.viewSelection,(function(a){return t("option",{key:a.name,domProps:{value:a.value}},[e._v(e._s(a.name))])})),0)]):e._e()],1)],1)],1):e._e()],1)],1)}),D=[],g=(a("99af"),a("caad"),a("14d9"),a("c1df")),x=a.n(g),b=a("c0d6"),y=a("d722"),k=function(){var e=this,t=e._self._c;return t(v["a"],{attrs:{row:"",wrap:""}},[t(_["a"],{attrs:{xs12:""}},e._l(e.data,(function(a,i,n){return t(f["a"],{key:i,attrs:{label:e.$_deviceColumnUnitMixin_withUnit(i),value:a,readonly:""}})})),1)],1)},A=[],C=a("a766"),R={name:"DeviceDataPeek",props:["data"],mixins:[C["b"]],created:function(){console.log("created DeviceDataPeek")},filters:{withUnit:function(e){var t=this.$_deviceColumnUnitMixin_getUnit(e);return""!==t?"".concat(e," (").concat(t,")"):e}}},S=R,M=a("2877"),I=Object(M["a"])(S,k,A,!1,null,"5822e5a1",null),T=I.exports,W=a("8fea"),$=function(){var e=this,t=e._self._c;return t(W["a"],{staticClass:"elevation-1 pa-0 ma-0",attrs:{headers:e.headers,items:e.data,"rows-per-page-items":e.rowsPerPageItems,pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"items",fn:function(a){return e._l(e.columns,(function(i){return t("td",[e._v(e._s(a.item[i]))])}))}}])})},O=[],P={name:"DeviceDataTable",props:["data","columns"],mixins:[C["b"]],created:function(){console.log("created DeviceDatatable")},computed:{headers:function(){var e=this,t=[];return t=this.columns.map((function(t){var a=e.$_deviceColumnUnitMixin_getUnit(t);return{text:""!==a?"".concat(t," (").concat(a,")"):t,value:t,align:"left"}})),t}},data:function(){return{rowsPerPageItems:[10,20,30,40,{text:"All",value:-1}],pagination:{rowsPerPage:10,sortBy:"Datetime Read",descending:!0}}}},U=P,j=(a("742f"),Object(M["a"])(U,$,O,!1,null,"401e27a1",null)),V=j.exports,L=(a("159b"),a("1fca")),H=a("bbf4"),Y={extends:L["Bar"],name:"DeviceDataRainfallChart",props:["data","title"],mixins:[H["b"]],mounted:function(){console.log("created DeviceDataRainfallChart"),this.loadrainchart()},methods:{loadrainchart:function(){var e=[],t=[];this.data.forEach((function(a){var i=x()(a["Datetime Read"],"YYYY-MM-DD HH:mm:ss");e.push({t:i.valueOf(),y:parseFloat(a["Rainfall Amount"])}),t.push({t:i.valueOf(),y:parseFloat(a["Rain Cumulative"])})})),this.$_rainfallChartMixin_setRainfall(e),this.$_rainfallChartMixin_setRainCumulative(t);var a="[NODATA]",i=this.data.length;i>0&&(a=this.data[0]["Datetime Read"]+" -- "+this.data[0]["Rain Cumulative"]+" mm");var n=[this.title,a];this.$_rainfallChartMixin_setTitle(n),this.$_rainfallChartMixin_render()}},watch:{data:function(e,t){console.log("data updated"),this.loadrainchart()}}},E=Y,G=Object(M["a"])(E,i,n,!1,null,"2617a8d2",null),B=G.exports,F={extends:L["Line"],name:"DeviceDataWaterlevelChart",props:["data","title","threshold"],mixins:[H["c"]],mounted:function(){this.loadwaterlevelchart()},methods:{loadwaterlevelchart:function(){var e=this.data.map((function(e){var t=x()(e["Datetime Read"],"YYYY-MM-DD HH:mm:ss");return{t:t.valueOf(),y:parseFloat(e["Waterlevel"])}}));this.$_waterlevelChartMixin_setWaterlevel(e);var t="[NODATA]",a=this.data.length;a>0&&(t=this.data[0]["Datetime Read"]+" -- "+this.data[0]["Waterlevel"]+" m");var i=[this.title,t];this.$_waterlevelChartMixin_setTitle(i),this.$_waterlevelChartMixin_setThresholds(this.threshold["water_40"],this.threshold["water_60"],this.threshold["water_80"]),this.$_waterlevelChartMixin_render()}},watch:{data:function(e,t){console.log("data updated"),this.loadwaterlevelchart()}}},N=F,z=Object(M["a"])(N,r,s,!1,null,"263d7bd3",null),J=z.exports,q={extends:L["Line"],name:"DeviceDataHeatIndex",mixins:[H["a"]],props:["data","title"],mounted:function(){this.loadheatindexchart()},methods:{loadheatindexchart:function(){var e=[],t=[];this.data.forEach((function(a){var i=x()(a["Datetime Read"],"YYYY-MM-DD HH:mm:ss");e.push({t:i.valueOf(),y:parseFloat(a["Air Temperature"])}),t.push({t:i.valueOf(),y:parseInt(a["Heat Index"])})})),this.$_heatIndexChartMixin_setTemperature(e),this.$_heatIndexChartMixin_setHeatIndex(t);var a="[NODATA]",i=this.data.length;i>0&&(a=this.data[0]["Datetime Read"]+" -- "+this.data[0]["Air Temperature"]+" / "+this.data[0]["Heat Index"]+" Â°C");var n=[this.title,a];this.$_heatIndexChartMixin_setTitle(n),this.$_heatIndexChartMixin_render()}},watch:{data:function(e,t){console.log("data updated"),this.loadheatindexchart()}}},K=q,Q=Object(M["a"])(K,l,o,!1,null,"10b6f47c",null),X=Q.exports,Z=a("12b2"),ee=a("cc20"),te=a("132d"),ae=function(){var e=this,t=e._self._c;return t("div",[t(Z["a"],{staticClass:"pb-1",attrs:{"primary-title":""}},[t(v["a"],{attrs:{row:"",wrap:""}},[t(_["a"],{attrs:{grow:""}},[e.citymun!==e.province?t("h3",{staticClass:"mb-0"},[e._v(e._s(e.citymun)+" - "+e._s(e.province)+" ("+e._s(e.dev_id)+")")]):t("h3",{staticClass:"mb-0"},[e._v(e._s(e.citymun)+" ("+e._s(e.dev_id)+")")]),t("div",[e._v(" "+e._s(e.location))])]),t(_["a"],{attrs:{shrink:""}},[e.loading?t("div",[t(ee["a"],{attrs:{"text-color":"white",small:""}},[t(m["a"],{attrs:{indeterminate:"",size:"18",color:"secondary"}})],1)],1):t("div",[0===e.selectedStatus||e.selectionMode?t(ee["a"],{attrs:{color:"green","text-color":"white",small:""},on:{click:function(t){return e.onToggle(0)}}},[e._v(" Enabled "),t(te["a"],{attrs:{right:""}},[e._v("check_circle")])],1):e._e(),1===e.selectedStatus||e.selectionMode?t(ee["a"],{attrs:{color:"red darken-1","text-color":"white",small:""},on:{click:function(t){return e.onToggle(1)}}},[e._v(" Disabled "),t(te["a"],{attrs:{right:""}},[e._v("error")])],1):e._e(),2===e.selectedStatus||e.selectionMode?t(ee["a"],{attrs:{color:"red darken-1","text-color":"white",small:""},on:{click:function(t){return e.onToggle(2)}}},[e._v(" Disabled Rain "),t(te["a"],{attrs:{right:""}},[e._v("error")])],1):e._e(),3===e.selectedStatus||e.selectionMode?t(ee["a"],{attrs:{color:"red darken-1","text-color":"white",small:""},on:{click:function(t){return e.onToggle(3)}}},[e._v(" Disabled Water Level "),t(te["a"],{attrs:{right:""}},[e._v("error")])],1):e._e()],1)])],1)],1)],1)},ie=[],ne=a("5530"),re=(a("2532"),a("2f62")),se={created:function(){console.log("permissionsMixin")},computed:Object(ne["a"])({},Object(re["b"])(["userPermissions"])),methods:{$__permissionsMixin_canUpdateDeviceInfo:function(){return this.userPermissions.includes("device-update-status")}}},le={name:"DeviceInfo",props:["dev_id","province","citymun","location","status"],mixins:[se],created:function(){console.log("created DeviceInfo"),this.selectedStatus=this.status},data:function(){return{selectedStatus:-1,selectionMode:!1,loading:!1}},methods:{onToggle:function(e){var t=this;if(!this.$__permissionsMixin_canUpdateDeviceInfo())return!1;this.selectionMode?(this.loading=!0,this.$nextTick((function(){Object(y["O"])(t.dev_id,e).then((function(a){a.data.success&&(t.selectedStatus=e,t.$emit("updatedStatus",{dev_id:t.dev_id,status:e}))})).catch((function(e){console.log(e)})),t.loading=!1,t.selectionMode=!1}))):this.selectionMode=!0}}},oe=le,de=Object(M["a"])(oe,ae,ie,!1,null,"4f0b548e",null),ce=de.exports,he=a("8336"),ue=function(){var e=this,t=e._self._c;return t(d["a"],[t(v["a"],{attrs:{row:""}},[t(_["a"],{attrs:{xs12:""}},[t("h3",[e._v("Water Level Thresholds:")])])],1),t(v["a"],{attrs:{"align-start":"","justify-space-between":"",row:"",wrap:""}},[t(_["a"],{attrs:{xs12:"",md3:""}},[t(f["a"],{class:{"mx-1":!0,"py-2":e.$vuetify.breakpoint.smAndDown},attrs:{label:"40% (cm):",placeholder:"Enter water level at 40%",outline:"",type:"number","hide-details":""},model:{value:e.water_40,callback:function(t){e.water_40=t},expression:"water_40"}})],1),t(_["a"],{attrs:{xs12:"",md3:""}},[t(f["a"],{class:{"mx-1":!0,"pb-2":e.$vuetify.breakpoint.smAndDown},attrs:{label:"60% (cm):",placeholder:"Enter water level at 60%",outline:"","hide-details":"",type:"number"},model:{value:e.water_60,callback:function(t){e.water_60=t},expression:"water_60"}})],1),t(_["a"],{attrs:{xs12:"",md3:""}},[t(f["a"],{class:{"mx-1":!0,"pb-2":e.$vuetify.breakpoint.smAndDown},attrs:{label:"80% (cm):",placeholder:"Enter water level at 80%",outline:"","hide-details":"",type:"number"},model:{value:e.water_80,callback:function(t){e.water_80=t},expression:"water_80"}})],1),t(_["a"],{attrs:{xs12:"",md3:""}},[t(f["a"],{class:{"mx-1":!0,"pb-2":e.$vuetify.breakpoint.smAndDown},attrs:{label:"Spike Threshold (cm):",placeholder:"Enter abnormal water level rise",outline:"",type:"number"},model:{value:e.spike_thr,callback:function(t){e.spike_thr=t},expression:"spike_thr"}})],1)],1),t(v["a"],{attrs:{row:""}},[t(_["a"],{attrs:{xs12:""}},[t("div",{staticClass:"text-xs-center"},[t(he["a"],{attrs:{disabled:!e.changed},on:{click:e.reset}},[e._v("Reset")]),t(he["a"],{attrs:{color:"secondary",disabled:!e.changed},on:{click:function(t){return t.preventDefault(),e.save.apply(null,arguments)}}},[e._v("Save")])],1)])],1)],1)},_e=[],ve={name:"DeviceThreshold",props:["data"],created:function(){this.original_water_40=this.data.water_40,this.original_water_60=this.data.water_60,this.original_water_80=this.data.water_80,this.original_spike_thr=this.data.spike_thr,this.reset()},computed:{changed:function(){return this.water_40!==this.original_water_40||this.water_60!==this.original_water_60||this.water_80!==this.original_water_80||this.spike_thr!==this.original_spike_thr}},data:function(){return{dev_id:"",original_water_40:"",original_water_60:"",original_water_80:"",original_spike_thr:"",water_40:"",water_60:"",water_80:"",spike_thr:"",api_error:"",loaded:!1}},methods:{reset:function(){this.dev_id=this.data.dev_id,this.water_40=this.original_water_40,this.water_60=this.original_water_60,this.water_80=this.original_water_80,this.spike_thr=this.original_spike_thr},save:function(){var e=this;Object(y["P"])({dev_id:parseInt(this.dev_id),water_40:parseInt(this.water_40),water_60:parseInt(this.water_60),water_80:parseInt(this.water_80),spike_thr:parseInt(this.spike_thr)}).then((function(t){e.original_water_40=t.data.water_40,e.original_water_60=t.data.water_60,e.original_water_80=t.data.water_80,e.original_spike_thr=t.data.spike_thr,e.$emit("threshold_updated",t.data)})).catch((function(t){e.reset()}))}}},pe=ve,me=Object(M["a"])(pe,ue,_e,!1,null,"ffc08e06",null),fe=me.exports,we=a("0261"),De={name:"DeviceDataLatest",props:["dev_id","canmodifydevices"],mixins:[we["a"]],components:{DeviceDataPeek:T,DeviceDataTable:V,DeviceDataRainfallChart:B,DeviceDataWaterlevelChart:J,DeviceDataHeatIndexChart:X,DeviceInfo:ce,DeviceThreshold:fe},created:function(){var e=this;console.log("created DeviceView"),this.selectedDate=b["a"].getters.getDevicesLastDate,Object(y["i"])(this.dev_id).then((function(t){b["a"].commit("clearErrors"),e.device.dev_id=t.data.dev_id,e.device.citymun=t.data.citymun_desc,e.device.province=t.data.province_desc,e.device.location=t.data.locationDesc,e.device.status=t.data.status,e.device.type_name=t.data.type_name,null!==t.data.threshold&&(e.device.threshold.water_40=t.data.threshold.water_40,e.device.threshold.water_60=t.data.threshold.water_60,e.device.threshold.water_80=t.data.threshold.water_80,e.device.threshold.spike_thr=t.data.threshold.spike_thr),e.title="".concat(e.device.citymun," - ").concat(e.device.location," (").concat(e.device.dev_id,")"),["VAISALA","Rain1","Rain2","UAAWS","BSWM_Lufft","Davis","PAGASA Rain"].includes(e.device.type_name)?e.selectedView="rainfall":["Waterlevel","Waterlevel & Rain 2","PAGASA Waterlevel","PAGASA Waterlevel & Rain"].includes(e.device.type_name)&&(e.selectedView="waterlevel"),e.loadDeviceData()})).catch((function(){b["a"].commit("setErrors",["Cannot connect to server. Please try again."]),e.$emit("error-loading")}))},computed:{viewSelection:function(){var e=[{name:"Last Data",icon:"remove_red_eye",color:"primary",value:"last_data"},{name:"Table",icon:"table_chart",color:"amber",value:"table"}];return["VAISALA","Rain1","Rain2","Waterlevel & Rain 2","UAAWS","BSWM_Lufft","Davis","PAGASA Rain","PAGASA Waterlevel & Rain"].includes(this.device.type_name)&&e.push({name:"Rainfall",icon:"cloud",color:"green",value:"rainfall"}),["Waterlevel","Waterlevel & Rain 2","PAGASA Waterlevel","PAGASA Waterlevel & Rain"].includes(this.device.type_name)&&e.push({name:"Waterlevel",icon:"waves",color:"blue",value:"waterlevel"}),["VAISALA","UAAWS","BSWM_Lufft","Davis"].includes(this.device.type_name)&&e.push({name:"Heat Index",icon:"ac_unit",color:"purple",value:"heat_index"}),this.canmodifydevices&&e.push({name:"Thresholds",icon:"config",color:"purple",value:"thresholds"}),e},latest_response:function(){return this.response[0]},rainfall_response:function(){return this.response.map((function(e){return{"Datetime Read":e["Datetime Read"],"Rainfall Amount":e["Rainfall Amount"],"Rain Cumulative":e["Rain Cumulative"]}}))},waterlevel_response:function(){return this.response.map((function(e){return{"Datetime Read":e["Datetime Read"],Waterlevel:e["Waterlevel"]}}))},heatindex_response:function(){return this.response.map((function(e){return{"Datetime Read":e["Datetime Read"],"Air Temperature":e["Air Temperature"],"Heat Index":e["Heat Index"]}}))},device_waterlevel_threshold_response:function(){return{dev_id:this.device.dev_id,water_40:this.device.threshold.water_40,water_60:this.device.threshold.water_60,water_80:this.device.threshold.water_80,spike_thr:this.device.threshold.spike_thr}}},data:function(){return{device:{dev_id:0,citymun:"",province:"",location:"",status:0,type_name:"",threshold:{water_40:"",water_60:"",water_80:"",spike_thr:""}},loading:"loading",response:[],columns:[],title:"",selectedView:"last_data",menuDate:"",selectedDate:""}},methods:{loadDeviceData:function(){var e,t=this;e=""===this.selectedDate||this.selectedDate===this.nowDateISOStr?Object(y["B"])(this.dev_id):Object(y["g"])(this.dev_id,this.selectedDate),e.then((function(e){b["a"].commit("clearErrors");var a=e.data.Data.length;0===a||!("Datetime Read"in e.data.Data[a-1])&&!("dateTimeRead"in e.data.Data[0])?t.loading="nodata":(t.response=e.data.Data,t.columns=e.data.Columns,t.loading="loaded")})).catch((function(e){b["a"].commit("setErrors",["Cannot connect to server. Please try again."]),t.$emit("error-loading")}))},onDateClear:function(){console.log("onDateClear"),this.selectedDate=""},onDateInput:function(e){this.menuDate=!1,console.log(e)},onUpdatedDeviceStatus:function(e){console.log("onUpdatedDeviceStatus"),this.$emit("deviceUpdatedStatus",e)},onUpdatedThresholds:function(e){console.log(e),this.device.threshold.water_40=e.water_40,this.device.threshold.water_60=e.water_60,this.device.threshold.water_80=e.water_80,this.device.threshold.spike_thr=e.spike_thr}},watch:{selectedDate:function(e,t){console.log("selectedDate Updating ".concat(t," ---to--- ").concat(e)),e!==b["a"].getters.getDevicesLastDate&&(b["a"].commit("setDevicesLastDate",e),this.loadDeviceData())}}},ge=De,xe=Object(M["a"])(ge,w,D,!1,null,"57a15a25",null);t["default"]=xe.exports}}]);